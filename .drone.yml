---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  - name: check-coverage
    image: node:12
    commands:
      - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/nodejsscan
    commands:
      - python /usr/src/app/cli.py -d dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: ccugi9SLiTChs9y10jd/9Ul1lT/VbdqBtc1ce8SmbCkhMcBofJssY0LBfevzT3yGQLa4cm4bNTVuyVGWI7q4Ww==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: d728bbe4867fa2b69d808393b24814b70eae951f68d5d4be87ab0d6318e53554

...
